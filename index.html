<!doctype html>
<html lang="pt-BR">
<head>
<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                var filteredData = jsonData.filter(row => row.some(filledCell));
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Calculadora RTG</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#002f6c">
<link rel="canonical" href="https://rodrigo-cavt.github.io/calculadora-rtg/">
<style>
  :root {
    --azul: #002f6c;
    --fundo: #f4f6fa;
    --verde: #28a745;
    --vermelho: #dc3545;
    --cinza: #e9eef7;
    --texto: #111;
  }
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: var(--fundo);
    color: var(--texto);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    font-size: 16px;
    line-height: 1.4;
    width: 100vw;
    overflow-x: hidden;
  }
  header {
    background: var(--azul);
    color: #fff;
    padding: 5px;
    text-align: center;
    font-size: 25px;
    font-weight: 700;
  }
  .wrap {
    flex: 1;
    width: 100%;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .control-row {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .controls label {
    font-weight: 600;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .controls input[type=number] {
    padding: 6px;
    border-radius: 4px;
    border: 1px solid #bbb;
    font-size: 16px;
    width: 100%;
    max-width: 80px;
    text-align: center;
  }
  .controls input[type=checkbox] {
    transform: scale(1.2);
  }
  .controls .kmanual {
    max-width: 40px;
  }
  .control-row.button-row {
    justify-content: flex-end;
  }
  .divider {
    border-left: 1px solid #bbb;
    height: 20px;
    margin: 0 5px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    table-layout: fixed;
  }
  th, td {
    border: none;
    padding: 6px;
    text-align: center;
    vertical-align: middle;
    font-size: 16px;
  }
  th {
    background: var(--azul);
    color: #fff;
  }
  th:nth-child(1), td:nth-child(1) { width: 10%; }
  th:nth-child(2), td:nth-child(2) { width: 25%; }
  th:nth-child(3), td:nth-child(3) { width: 30%; }
  th:nth-child(4), td:nth-child(4) { width: 20%; }
  th:nth-child(5), td:nth-child(5) { width: 25%; }
  .adv {
    width: 100%;
    padding: 4px;
    font-size: 16px;
    text-align: center;
    box-sizing: border-box;
    vertical-align: middle;
  }
  .resultado {
    display: flex;
    gap: 2px;
    justify-content: center;
    align-items: center;
    width: 100%;
    margin: 0 auto;
    height: 100%;
  }
  .resultado span {
    display: inline-block;
    vertical-align: middle;
  }
  .resultado input[type=radio] {
    display: none;
  }
  .resultado label {
    padding: 4px 6px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    border: none;
    line-height: 1.5;
    display: inline-block;
    vertical-align: middle;
    min-height: 24px;
    text-align: center;
  }
  .resultado input[type=radio]:disabled + label {
    background: #e0e0e0;
    color: #999;
    cursor: not-allowed;
    opacity: 0.6;
  }
  .v label {
    background: #dff5df;
    color: var(--verde);
  }
  .e label {
    background: #f0f0f0;
    color: #555;
  }
  .d label {
    background: #ffe6e6;
    color: var(--vermelho);
  }
  .v input:checked + label {
    background: var(--verde);
    color: #fff;
  }
  .e input:checked + label {
    background: #6c757d;
    color: #fff;
  }
  .d input:checked + label {
    background: var(--vermelho);
    color: #fff;
  }
  .delta.pos {
    color: var(--verde);
    font-weight: 700;
  }
  .delta.neg {
    color: var(--vermelho);
    font-weight: 700;
  }
  .delta.zero {
    color: #000;
    font-weight: 700;
  }
  .final.pos {
    color: var(--verde);
    font-weight: 700;
  }
  .final.neg {
    color: var(--vermelho);
    font-weight: 700;
  }
  .final.zero {
    color: #000;
    font-weight: 700;
  }
  .final {
    font-size: 16px;
  }
  .summary {
    background: #fff;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
  }
  .summary-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }
  .summary-table th, .summary-table td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: center;
    vertical-align: middle;
    font-size: 16px;
  }
  .summary-table th:nth-child(1), .summary-table td:nth-child(1) { width: 33.33%; }
  .summary-table th:nth-child(2), .summary-table td:nth-child(2) { width: 33.33%; }
  .summary-table th:nth-child(3), .summary-table td:nth-child(3) { width: 33.33%; }
  .summary-table td.pontos {
    font-weight: 700;
  }
  .summary-table td.variacao-total.pos, .summary-table td.rtg-final.pos {
    font-weight: 700;
    color: var(--verde);
  }
  .summary-table td.variacao-total.neg, .summary-table td.rtg-final.neg {
    font-weight: 700;
    color: var(--vermelho);
  }
  .summary-table td.variacao-total.zero, .summary-table td.rtg-final.zero {
    font-weight: 700;
    color: #000;
  }
  button {
    background: var(--vermelho);
    color: #fff;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }
  @media (max-width: 600px) {
    body {
      font-size: 14px;
      width: 100vw;
      overflow-x: hidden;
    }
    header {
      font-size: 18px;
      padding: 8px;
    }
    .wrap {
      padding: 8px;
    }
    .controls label {
      font-size: 12px;
    }
    .controls input[type=number] {
      font-size: 16px;
      padding: 4px;
      max-width: 70px;
    }
    .controls .kmanual {
      max-width: 35px;
    }
    th, td {
      font-size: 16px;
      padding: 3px;
      vertical-align: middle;
    }
    .adv {
      width: 100%;
      font-size: 16px;
      padding: 3px;
      vertical-align: middle;
    }
    .resultado {
      width: 100%;
      margin: 0 auto;
      height: 100%;
    }
    .resultado label {
      padding: 3px 5px;
      font-size: 10px;
      min-height: 20px;
      vertical-align: middle;
    }
    .resultado input[type=radio]:disabled + label {
      background: #e0e0e0;
      color: #999;
      cursor: not-allowed;
      opacity: 0.6;
    }
    .final {
      font-size: 16px;
    }
    .summary {
      font-size: 16px;
      padding: 8px;
    }
    .summary-table th, .summary-table td {
      font-size: 16px;
      padding: 4px;
      vertical-align: middle;
    }
    button {
      font-size: 12px;
      padding: 5px 8px;
    }
    #tabela {
      max-height: 48vh;
      overflow: hidden;
    }
  }
</style>
</head>
<body>
<header>Calculadora RTG</header>
<div class="wrap">
  <div class="controls">
    <div class="control-row">
      <input type="radio" id="fide" name="tipoRating" value="fide">
      <label for="fide">FIDE</label>
      <input type="radio" id="cbx" name="tipoRating" value="cbx" checked>
      <label for="cbx">CBX</label>
      <label>Rtg. Inicial:
        <input id="ratingInicial" type="number" value="">
      </label>
    </div>
    <div class="control-row">
      <label>
        <input id="kAuto" type="checkbox" checked> K automático
      </label>
      <span class="divider"></span>
      <label>K manual:
        <input id="kManual" class="kmanual" type="number" value="25" disabledទ

System: ### Notas Importantes
- **Preservação do Código Existente**: O código fornecido é uma atualização do `index.html` anterior, mantendo toda a funcionalidade da Calculadora RTG, incluindo a lógica de cálculo para FIDE e CBX, o comportamento do botão "Limpar" (que agora preserva a seleção de "CBX" ou "FIDE"), o estilo (negrito em "Pontos", "Variação Total" e "Rtg. Final" coloridos, centralização vertical, divisor, etc.), e o suporte a XLSX. Apenas as tags e o script do PWA foram adicionados.
- **Mudanças Específicas**:
  - No `<head>`, após `<title>`:
    - Adicionada a linha `<link rel="manifest" href="manifest.json">`.
    - Adicionada `<meta name="theme-color" content="#002f6c">` (cor do cabeçalho).
    - Adicionada `<link rel="canonical" href="https://seu-usuario.github.io/calculadora-rtg/">` (substitua `seu-usuario` pelo seu nome de usuário do GitHub).
  - No final do `<body>`, antes de `</body>`:
    - Adicionado o script de registro do service worker:
      ```html
      <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js');
          });
        }
      </script>
      ```
- **ID do Artefato**: Mantido o mesmo `artifact_id` (`2d8e016b-76b2-4b9c-86ae-c68d2e21754d`) pois é uma atualização do arquivo anterior.

### Como Usar
1. **Atualize o Repositório no GitHub**:
   - No seu repositório (ex: `seu-usuario/calculadora-rtg`), clique em `index.html`.
   - Clique no ícone de lápis (✏️) para editar.
   - Substitua o conteúdo do `index.html` pelo código acima.
   - Adicione uma mensagem de commit (ex: "Adiciona suporte a PWA") e clique em "Commit changes".
2. **Verifique o GitHub Pages**:
   - Acesse `https://seu-usuario.github.io/calculadora-rtg/` após 1-2 minutos para confirmar que o site foi atualizado.
3. **Teste a Funcionalidade de PWA**:
   - Certifique-se de que os arquivos `manifest.json`, `sw.js`, `icon-192.png`, e `icon-512.png` estão no repositório (conforme os passos 3.1 e 3.2 do guia anterior).
   - Abra o site no Chrome (desktop ou Android) ou Safari (iOS).
   - No Chrome, clique nos 3 pontos > "Adicionar à tela inicial" ou "Instalar app". No Safari, use "Adicionar à Tela de Início".
   - Verifique se o app aparece na tela inicial do celular, abre em modo fullscreen e funciona offline (carrega a interface, mas cálculos podem não persistir offline sem dados salvos).
4. **Valide o PWA**:
   - No Chrome, abra DevTools (F12) > aba "Lighthouse" > selecione "Progressive Web App" > "Generate report". Deve indicar que o app é instalável.
5. **Atualize o Canonical URL**:
   - Substitua `seu-usuario` no `<link rel="canonical">` pelo seu nome de usuário do GitHub (ex: `https://joaodoe.github.io/calculadora-rtg/`).

### Notas
- **Arquivos Necessários**: Certifique-se de que `manifest.json`, `sw.js`, `icon-192.png`, e `icon-512.png` estão no repositório (raiz) e que os caminhos no `manifest.json` e `sw.js` correspondem ao nome do seu repositório (ex: `/calculadora-rtg/`).
- **Funcionalidade Offline**: O service worker fornecido cacheia apenas os arquivos principais. Cálculos requerem entrada de dados, que não são salvos offline.
- **Teste no Celular**: Após instalar como PWA, confirme que "CBX" permanece selecionado, "FIDE" e "CBX" estão habilitados após "Limpar", e que a interface mantém o layout (centralização, negrito, cores, etc.).
- **Ícones**: Use ícones quadrados (192x192 e 512x512) gerados por ferramentas como [favicon.io](https://favicon.io). Certifique-se de que os nomes dos arquivos correspondem ao `manifest.json`.

Se precisar de ajuda com os outros arquivos (`manifest.json`, `sw.js`, ícones) ou com algum erro no deploy, envie o nome do seu repositório ou detalhes do problema!
